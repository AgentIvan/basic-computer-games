<html>
  <head>
    <title>Minimal node.js terminal</title>
    <link
      rel="stylesheet"
      href="../../../00_Utilities/javascript/style_terminal.css"
    />
    <link
      rel="stylesheet"
      href="HtmlTerminal.css"
    />
  </head>
  <body>
    <div id="output"></div>
    <script src="HtmlTerminal.js" type="text/javascript"></script>
    <script>
      const term = new HtmlTerminal(document.getElementById("output"));

      function loadGameScript() {
        const hash = window.location.hash;
      
        // if no game-script was provided redirect to the overview.
        if (!hash) {
          // show error message and link back to the index.html
          console.debug('[HtmlTerminal] No game script found!');
          term.writeln(`no game script found :-(\n`);
          term.inserHtml(`<a href="/">>> Back to game overview!</a>`);
          return;
        }

        // remove the hash
        const gameFile = hash.replace('#','');

        // clear terminal
        term.clear();

        // load game-script
        console.debug('[HtmlTerminal] Game script found: ', gameFile);
        const gameScript = `../../../${gameFile}`;
        var $scriptTag = document.createElement("script");
        $scriptTag.async = 'async'
        $scriptTag.type = "module";
        $scriptTag.src = gameScript;
        $scriptTag.onerror = () => {
          term.clear();
          term.writeln(`Error loading game-script "${gameFile}" :-(\n`);
          term.inserHtml(`<a href="/">>> Back to game overview!</a>`);
        };
        $scriptTag.addEventListener('load', function() {
          console.log('[HtmlTerminal] Game script loaded!');
        });
        document.body.append($scriptTag);
      }

      /* Redirect stdin/stdout to the HtmlTerminal.
       * This is VERY hacky and should never be done in a serious project!
       * We can use this here because we know what we are doing and...
       * ...it's just simple games ;-) */
      window.process = {
        stdout: {
          write: (t) => term.write(t),
        },
        stdin: {
          on: (event, callback) => term.input(callback)
        },
        exit: (code) => {},
      };

      // let the games begin ðŸš€
      loadGameScript();
    </script>
  </body>
</html>
